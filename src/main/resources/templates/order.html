<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xsi:schemaLocation="http://www.thymeleaf.org "
      xmlns:th="http://www.thymeleaf.org"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      lang="ru"
>

<head>
  <div th:replace="fragments/header :: myHeader"></div>
</head>

<body>
<!-- Navbar -->
<div th:insert="fragments/navbar :: navbar('orders')"></div>

<br/>
<div class="container">
  <div class="row sectionRow">
    <div class="card">
      <div class="card-body">
        <form th:action="@{/orders/save}" th:object="${orderAtr}" id="form">
          <input type="hidden" th:field="*{orderId}">
          <input type="hidden" th:field="*{timestamp}">
          <input type="hidden" th:field="*{client}">
          <input type="hidden" th:field="*{smallDescription}">
          <input type="hidden" th:field="*{executeStatus}">
          <input type="hidden" th:field="*{executorId}">
          <input type="hidden" th:field="*{partsPrice}">
          <input type="hidden" th:field="*{workPrice}">
          <input type="hidden" th:field="*{parts}">
          <input type="hidden" th:field="*{works}">
          <input type="hidden" th:field="*{paymentStatus}">
          <input type="hidden" th:field="*{device}">
          <input type="hidden" th:field="*{orderDescription}">
          <div th:if="*{timeClose != null}">
            <input type="hidden" th:field="*{timeClose}">
          </div>

          <div class="order-info">
            <div class="order-number">
              <span class="text-for-order-number">Номер заказа:</span>
              <span class="number-of-order" th:text="*{orderId}">7015</span>
            </div>
            <div class="order-status">
              <span class="text-for-order-status">Стату заказа:</span>
              <span class="status-of-order"
                    th:text="*{executeStatus}">Принят</span>
            </div>

            <!--            Client section-->
            <div class="client-section">
              <div class="order-client">
                <span class="text-for-order-client">Клиент:</span>
                <span class="client-of-order" th:text="*{client != null} ? *{client.name} : 'Неизвестный клиент'">Михаил Велосипедовский</span>
              </div>
              <div class="order-phone">
                <span class="text-for-order-phone">Телефон:</span>
                <span class="phone-of-order" th:text="*{client != null} ? *{client.phoneNumber} : '- - -'">89154446015</span>
              </div>
            </div>
          </div>
          <hr/>

          <div class="vehicle-block">

            <div class="vehicle-info">
              <span class="text-for-vehicle-info">Что чиним:</span>
              <span th:if="*{device}"
                    class="value-of-vehicle-info"
                    th:text="*{device.deviceName}">Велосипед красный</span>
            </div>

            <div class="input-group mb-3" th:unless="*{device}">
              <!--Что чиним?-->
              <input type="text" class="form-control toClean rowIdGen"
                     th:field="*{device.deviceName}"
                     placeholder="Что чиним?" aria-label="Что чиним?">
              <span class="input-group-text toggle-button">
                                        <i class="fas fa-bicycle"></i></span>
              <!--Краткое описание-->
              <input type="text" class="form-control toClean rowIdGen"
                     th:field="*{device.description}"
                     placeholder="Описание" aria-label="Описание">
            </div>

            <div class="vehicle-info-additional">
              <span class="text-for-additional-info">Описание:</span>
              <span class="value-of-additional-info"
                    th:text="${orderAtr.fullDescription}"
              >Весь велосипед погнуло как буратину, наверное за зиму
                  так.</span
              >
            </div>
          </div>


          <div class="item-datalist input-group"
               th:each="service, j : *{listOfServices}">
            <input type="hidden" class="itemIdGen deleteId"
                   th:field="*{listOfServices[__${j.index}__].serviceId}">
            <input type="hidden" class="itemIdGen order"
                   th:field="*{listOfServices[__${j.index}__].order}">
            <!--            <input type="hidden" class="itemIdGen" th:field="*{listOfServices[__${j.index}__].price}">-->

            <!-- Quantity input -->
            <input type="number" class="qty form-control rowIdGen itemIdGen"
                   th:field="*{listOfServices[__${j.index}__].qty}"
                   value="1"
                   placeholder="Количество" aria-label="Краткое описание"
                   onchange="calculatePrice();">

            <!-- DataList -->
            <input
                class="datalist form-control rowIdGen itemIdGen"
                list="datalistOptions"
                placeholder="Что нужно сделать?"
                th:style="*{listOfServices[__${j.index}__].description} == '' ?
                                        'display:inline' : 'display:none'"
            >

            <!--                Hidden Input for datalist-->
            <input type="hidden" class="hiddenItem rowIdGen itemIdGen"
                   th:field="*{listOfServices[__${j.index}__].item}">

            <!--Price span label-->
            <span class="input-group-text price toggle-button"
                  th:if="*{listOfServices[__${j.index}__].item}"
                  th:text="*{listOfServices[__${j.index}__].item.price}"
                  th:style="*{listOfServices[__${j.index}__].description} == '' ?
                                      'display:inline' : 'display:none'">Цена</span>
            <span class="input-group-text price toggle-button"
                  th:unless="*{listOfServices[__${j.index}__].item}"
                  th:text="*{listOfServices[__${j.index}__].price}"
                  th:style="*{listOfServices[__${j.index}__].description} == '' ?
                                      'display:inline' : 'display:none'">Цена</span>

            <!--Input description-->
            <input type="text"
                   class="input form-control toClean rowIdGen itemIdGen"
                   th:field="*{listOfServices[__${j.index}__].description}"
                   placeholder="Краткое описание" aria-label="Краткое описание"
                   th:style="*{listOfServices[__${j.index}__].description} == '' ?
                                       'display:none' : 'display:inline'">

            <input type="number"
                   class="form-control price toClean rowIdGen itemIdGen"
                   onchange="calculatePrice();"
                   th:field="*{listOfServices[__${j.index}__].price}"
                   placeholder="Цена" aria-label="Цена"
                   th:style="*{listOfServices[__${j.index}__].description} == '' ?
                                       'display:none' : 'display:inline'">
            <select class="form-select itemIdGen"
                    th:field="*{listOfServices[__${j.index}__].executorId}">
              <option th:each="executor : ${usersAtr}"
                      th:text="${executor.fullName}"
                      th:value="${executor.id}"
                      th:selected="*{executorId} == ${service.executorId}"
              >
              </option>
            </select>
            <!--Кнопки плюс и минус-->
            <div>
              <button
                  class="btn btn-danger"
                  th:onclick="deleteWorkById('/services/delete?itemId=[[${service.serviceId}]]')"
                  type="button">
                <i aria-hidden="true" class="fa fa-minus float-right"></i>
              </button>
              <button
                  class="btn btn-success"
                  type="button"
                  onclick="duplicateItemList(this);">
                <i class="fa fa-plus" aria-hidden="true"></i>
              </button>
              <button
                  style="display: none"
                  class="btn btn-primary"
                  type="button"
                  onclick="exchange(this);">
                <i class="fas fa-exchange-alt"></i>
              </button>
            </div>
          </div>


          <div class="form-group textArea-comments">

            <textarea
                th:field="*{fullDescription}"
                class="form-control"
                id="textArea-comments1"
                rows="5"
            ></textarea>
          </div>

          <div class="price-text">
            <span class="price-text-inner">Итого денег: </span>
            <span class="price-text-sum" >30 000р.</span>
            <input type="hidden" class="price-text-sum-hidden" th:field="*{fullPrice}">
          </div>
          <button
              class="btn btn-primary"
              type="button"
              onclick="saveOrder();"
              id="confirm-order-button"
          >
            Сохранить заказ
          </button>


        </form>
      </div>
    </div>
  </div>
</div>

<datalist id="datalistOptions">
  <option th:each="item : ${itemsAtr}"
          th:price="${item.price}"
          th:value="${item.name}"
          th:data-value="${item.id}"
  >
  </option>
</datalist>

<div th:insert="fragments/footer :: myFooter"></div>
<script>
    window.onload = function () {
        hideAndDisplayDatalistButtons();
        addListeners();
        // loadItemsFromHidden();
        calculatePrice();
        document.querySelector("input.datalist")
            .dispatchEvent(new Event('input'));
        loadItemsFromHidden();
    }
</script>
</body>
</html>